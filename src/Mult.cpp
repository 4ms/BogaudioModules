
#include "Mult.hpp"

void Mult::process(const ProcessArgs& args) {
	float out = inputs[INA_INPUT].getVoltage();
	outputs[OUTA1_OUTPUT].setVoltage(out);
	outputs[OUTA2_OUTPUT].setVoltage(out);
	outputs[OUTA3_OUTPUT].setVoltage(out);

	if (inputs[INB_INPUT].isConnected()) {
		out = inputs[INB_INPUT].getVoltage();
	}
	outputs[OUTB1_OUTPUT].setVoltage(out);
	outputs[OUTB2_OUTPUT].setVoltage(out);
	outputs[OUTB3_OUTPUT].setVoltage(out);
}

struct MultWidget : ModuleWidget {
	static constexpr int hp = 3;

	MultWidget(Mult* module) {
		setModule(module);
		box.size = Vec(RACK_GRID_WIDTH * hp, RACK_GRID_HEIGHT);

		{
			SVGPanel *panel = new SVGPanel();
			panel->box.size = box.size;
			panel->setBackground(APP->window->loadSvg(asset::plugin(pluginInstance, "res/Mult.svg")));
			addChild(panel);
		}

		addChild(createWidget<ScrewSilver>(Vec(0, 0)));
		addChild(createWidget<ScrewSilver>(Vec(box.size.x - 15, 365)));

		// generated by svg_widgets.rb
		auto inaInputPosition = Vec(10.5, 21.0);
		auto inbInputPosition = Vec(10.5, 181.0);

		auto outa1OutputPosition = Vec(10.5, 62.0);
		auto outa2OutputPosition = Vec(10.5, 92.0);
		auto outa3OutputPosition = Vec(10.5, 122.0);
		auto outb1OutputPosition = Vec(10.5, 222.0);
		auto outb2OutputPosition = Vec(10.5, 252.0);
		auto outb3OutputPosition = Vec(10.5, 282.0);
		// end generated by svg_widgets.rb

		addInput(createInput<Port24>(inaInputPosition, module, Mult::INA_INPUT));
		addInput(createInput<Port24>(inbInputPosition, module, Mult::INB_INPUT));

		addOutput(createOutput<Port24>(outa1OutputPosition, module, Mult::OUTA1_OUTPUT));
		addOutput(createOutput<Port24>(outa2OutputPosition, module, Mult::OUTA2_OUTPUT));
		addOutput(createOutput<Port24>(outa3OutputPosition, module, Mult::OUTA3_OUTPUT));
		addOutput(createOutput<Port24>(outb1OutputPosition, module, Mult::OUTB1_OUTPUT));
		addOutput(createOutput<Port24>(outb2OutputPosition, module, Mult::OUTB2_OUTPUT));
		addOutput(createOutput<Port24>(outb3OutputPosition, module, Mult::OUTB3_OUTPUT));
	}
};

Model* modelMult = bogaudio::createModel<Mult, MultWidget>("Bogaudio-Mult", "Mult",  "multiple", MULTIPLE_TAG);
